# Multithreaded Prime Counter

## Overview
The `myCounter` program is an optimized version of a prime number counter that leverages multithreading and batch processing to efficiently determine the count of prime numbers from a large set of integers.

## How It Works
The program processes a stream of numbers generated by the `randomGenerator` tool. It counts the number of primes by dividing the work into batches and using multiple threads to parallelize the computation.

## Features
- **Batch Processing**: To reduce the overhead of thread synchronization, the program groups incoming numbers into batches. Each batch is then processed independently by a worker thread.
- **Multithreading**: The program utilizes multiple threads to enable concurrent processing of separate batches, which can significantly speed up the computation on multicore processors.

## Usage
To run the program with custom settings, use the following command structure:
```sh
./randomGenerator <seed> <number_count> | ./myCounter -t <num_threads> -b <batch_size>
```


- `<seed>`: A seed value for the random number generator.
- `<number_count>`: The total number of random numbers to generate.
- `<num_threads>`: The number of worker threads to use for processing batches.
- `<batch_size>`: The number of numbers in each batch for processing.

If the `-t` (threads) and `-b` (batch size) flags are not provided, the program will default to using 8 threads and a batch size of 100,000.

## Performance
The `myCounter` program has been benchmarked against a simple, single-threaded prime counter. Here are the conclusions based on the provided time comparison:

- When using `myCounter` with multithreading and batch processing, the computation is significantly faster than using a simple single-threaded approach.
- Optimal performance is achieved by adjusting the number of threads and batch size. The ideal settings may vary depending on the hardware and the size of the dataset.

## Recommendations
- It is recommended to start with the default settings (8 threads and 100k batch size) and adjust accordingly based on the performance observed.
- For larger datasets, increasing the number of threads may yield better performance, provided that the machine has sufficient CPU cores.
- Batch size may be tuned to find the optimal balance between overhead and throughput. Larger batches may reduce synchronization costs but could also lead to uneven workload distribution.

## Conclusion
The `myCounter` program demonstrates the advantages of multithreaded processing in computational tasks. With the appropriate settings, it can vastly outperform a simple single-threaded counter, making it a valuable tool for processing large datasets in a fraction of the time.

## Note(arkSolution Comparison)
I cannot run arkSolution to compare results, because of difference in architectures.

I can compare them on relative way only (not-fair):

    randomGenerator: Seed: 10 Numbers: 10 Million

    Results from the video explanation:

        * Original primeCounter: 1 minute and 10 seconds
        * Optimized solution (arkSolution): 8.2 seconds

        Solution shows an approximately 8.54 times speed-up (70 sec / 8.2 sec ≈ 8.54)

    My results:

        * Original primeCounter: 44 seconds
        * Optimized solution (myCounter): 1.433 seconds

        Solution shows an approximately 30.7 times speed-up (44 sec / 1.433 sec ≈ 30.7)
        
    Its almost 4x better in relative way

## Example
```sh
nikita@NikitaVM:~/Desktop/PrimeCounter$ time ./randomGenerator 10 10000000 | ./arkSolution
bash: ./arkSolution: cannot execute binary file: Exec format error

real	0m0.006s
user	0m0.006s
sys	0m0.000s
nikita@NikitaVM:~/Desktop/PrimeCounter$ file ./arkSolution 
./arkSolution: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=b854357bef0573e826e253432582ec13bfa8693b, for GNU/Linux 3.2.0, not stripped
nikita@NikitaVM:~/Desktop/PrimeCounter$ file ./myCounter 
./myCounter: ELF 64-bit LSB pie executable, ARM aarch64, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux-aarch64.so.1, BuildID[sha1]=ee7b33c3c4207032b1ddba85a0f71f66dae05170, for GNU/Linux 3.7.0, not stripped

nikita@NikitaVM:~/Desktop/PrimeCounter$ time ./randomGenerator 10 10000000 | ./primeCounter 
491146 total primes.

real	0m44.014s
user	0m44.498s
sys	0m0.528s
nikita@NikitaVM:~/Desktop/PrimeCounter$ time ./randomGenerator 10 10000000 | ./myCounter 
491146 total primes.

real	0m1.433s
user	0m9.638s
sys	0m0.064s
nikita@NikitaVM:~/Desktop/PrimeCounter$ ./randomGenerator 10 10000000 | valgrind --tool=massif ./myCounter
==7377== Massif, a heap profiler
==7377== Copyright (C) 2003-2017, and GNU GPL'd, by Nicholas Nethercote
==7377== Using Valgrind-3.18.1 and LibVEX; rerun with -h for copyright info
==7377== Command: ./myCounter
==7377== 
491146 total primes.
==7377== 
nikita@NikitaVM:~/Desktop/PrimeCounter$ ms_print massif.out.7377 
--------------------------------------------------------------------------------
Command:            ./myCounter
Massif arguments:   (none)
ms_print arguments: massif.out.7377
--------------------------------------------------------------------------------


    MB
1.151^                  :#    :                                               
     |                  :#    :                                               
     |                  :#    :                                               
     |                  :#    :                                               
     |                  :#    :                                               
     |                  :#    :                                               
     |                  :#    :                                               
     |@   :   ::   :    :#   @:             @      :         :  :             
     |@   :   ::   :    :#   @:             @      :         :  :             
     |@   :   ::   :    :#   @:             @      :         :  :             
     |@   :   ::   :    :#   @:             @      :         :  :             
     |@   :   ::   :    :#   @:             @      :         :  :             
     |@   :   ::   :    :#   @:             @      :         :  :             
     |@   :   ::   :    :#   @:             @      :         :  :             
     |@::::::::::::::::::#:::@:@:::@::::::::@::::::::@::::::@:::::::@::::::@::
     |@::::::::::::::: ::#: :@:@:::@:::: :::@::::::::@::::::@:::::::@::::::@::
     |@::::::::::::::: ::#: :@:@:::@:::: :::@::::::::@::::::@:::::::@::::::@::
     |@::::::::::::::: ::#: :@:@:::@:::: :::@::::::::@::::::@:::::::@::::::@::
     |@::::::::::::::: ::#: :@:@:::@:::: :::@::::::::@::::::@:::::::@::::::@::
     |@::::::::::::::: ::#: :@:@:::@:::: :::@::::::::@::::::@:::::::@::::::@::
   0 +----------------------------------------------------------------------->Gi
     0                                                                   74.28
```
